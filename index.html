<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>æ¹¯å·ãƒãƒ†ãƒ³ã‚·ãƒ£ãƒ«ã‹ã‚‰å§‹ã‚ã‚‹ç´ æ•°è¨ˆç®—ã®å¿ƒè‡“éƒ¨</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <!-- MathJax -->
  <script>
    window.MathJax = {
      tex: {
        inlineMath: [['$', '$'], ['\\(', '\\)']]
      }
    };
  </script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js" async></script>
  
  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Shippori+Mincho:wght@400;500;700&display=swap" rel="stylesheet">

  <style>
    :root {
      --bg-paper: #fdfdfa;
      --bg-panel: #ffffff;
      --text-ink: #2b2b2b;
      --text-sub: #595857;
      
      --color-indigo: #1e3f66;
      --color-purple: #6a4c9c;
      --color-gold: #c7a65d;
      --color-vermilion: #b54938;
      --color-matcha: #5c7a47;

      --border-thin: 1px solid rgba(43, 43, 43, 0.15);
      --shadow-paper: 0 4px 20px rgba(30, 63, 102, 0.05);
    }

    * {
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
    }

    body {
      margin: 0;
      min-height: 100vh;
      font-family: "Shippori Mincho", "Yu Mincho", "Hiragino Mincho ProN", serif;
      background-color: var(--bg-paper);
      background-image: 
        radial-gradient(circle at 50% 0%, rgba(30, 63, 102, 0.03) 0%, transparent 70%),
        linear-gradient(to right, rgba(43,43,43,0.02) 1px, transparent 1px),
        linear-gradient(to bottom, rgba(43,43,43,0.02) 1px, transparent 1px);
      background-size: 100% 100%, 40px 40px, 40px 40px;
      color: var(--text-ink);
      display: flex;
      justify-content: center;
      line-height: 1.7;
    }

    .wrapper {
      width: 100%;
      max-width: 1000px;
      padding: 40px 20px 80px;
      position: relative;
    }

    /* ã‚¹ãƒãƒ›å‘ã‘ï¼šä½™ç™½ã‚’æœ€é©åŒ– */
    @media (max-width: 600px) {
      .wrapper {
        padding: 30px 16px 80px;
      }
    }

    /* --- ãƒ˜ãƒƒãƒ€ãƒ¼ã‚¨ãƒªã‚¢ --- */
    .header-area {
      margin-bottom: 40px;
      text-align: center;
      position: relative;
      border-bottom: 1px solid rgba(43, 43, 43, 0.1);
      padding-bottom: 24px;
    }
    .header-area::after {
      content: "";
      position: absolute;
      bottom: 2px;
      left: 15%;
      right: 15%;
      height: 1px;
      background: var(--color-indigo);
      opacity: 0.3;
    }

    .title-main {
      font-size: 28px;
      font-weight: 700;
      margin-bottom: 16px;
      color: var(--text-ink);
      letter-spacing: 0.05em;
      font-feature-settings: "palt";
      line-height: 1.4;
    }
    
    .title-sub {
      font-size: 14px;
      color: var(--text-sub);
      font-weight: 500;
      line-height: 1.9;
      display: inline-block;
      max-width: 720px;
      text-align: left;
      /* ã‚¹ãƒãƒ›ã§ã®ä¸è‡ªç„¶ãªæ”¹è¡Œã‚’é˜²ããŸã‚ã€PCã§ã®æ”¹è¡Œä½ç½®ã‚’æ„è­˜ã—ã¤ã¤è‡ªç„¶ã«æµã™ */
      word-wrap: break-word;
    }
    .title-sub strong {
      color: var(--color-indigo);
      font-weight: 700;
    }

    @media (max-width: 600px) {
      .title-main { font-size: 22px; margin-bottom: 12px; }
      .title-sub { 
        font-size: 13px; 
        text-align: justify; /* ã‚¹ãƒãƒ›ã§ã¯ä¸¡ç«¯æƒãˆã§ç¾ã—ã */
        line-height: 1.8; 
      }
    }

    /* --- ã‚¹ãƒ†ãƒƒãƒ—ã‚¬ã‚¤ãƒ‰ --- */
    .step-guide {
      display: flex;
      gap: 16px;
      margin-bottom: 40px;
      justify-content: center;
      flex-wrap: wrap;
    }
    .step-card {
      background: transparent;
      border-bottom: 2px solid rgba(43, 43, 43, 0.1);
      padding: 12px 10px;
      min-width: 200px;
      flex: 1;
      text-align: center;
      transition: border-color 0.3s;
    }
    .step-card:hover { border-color: var(--color-indigo); }
    .step-num {
      font-size: 11px;
      font-weight: 700;
      color: var(--color-gold);
      letter-spacing: 0.1em;
      text-transform: uppercase;
      display: block;
      margin-bottom: 6px;
    }
    .step-text {
      font-size: 13px;
      font-weight: 500;
      color: var(--text-ink);
      line-height: 1.5;
    }
    @media (max-width: 600px) {
      .step-guide { flex-direction: column; gap: 12px; margin-bottom: 30px; }
      .step-card { 
        min-width: auto; 
        text-align: left; 
        padding: 10px 0; 
        border-bottom: 1px solid rgba(43,43,43,0.1);
        display: flex; /* æ¨ªä¸¦ã³ã«ã™ã‚‹ */
        align-items: baseline;
        gap: 8px;
      }
      .step-num { 
        margin-bottom: 0; 
        white-space: nowrap; 
        min-width: 45px; /* ãƒ©ãƒ™ãƒ«å¹…å›ºå®š */
      }
      .step-text { font-size: 13px; }
    }

    /* --- ç†è«–ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ --- */
    .theory-pipeline {
      display: flex;
      align-items: center;
      justify-content: center;
      flex-wrap: wrap;
      gap: 10px 16px;
      margin-bottom: 50px;
      padding: 16px;
      background: rgba(255, 255, 255, 0.6);
      border: 1px dashed rgba(43, 43, 43, 0.2);
      border-radius: 6px;
      font-size: 12px;
      color: var(--text-sub);
    }
    .theory-pipeline span {
      font-weight: 600;
      color: var(--color-indigo);
      padding: 6px 12px;
      background: #fff;
      border: 1px solid rgba(30, 63, 102, 0.1);
      border-radius: 4px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.03);
      white-space: nowrap;
    }
    .pipeline-arrow {
      color: var(--color-gold);
      font-size: 14px;
    }
    .pipeline-label {
      width: 100%; text-align: center; margin-bottom: 8px; color:var(--text-sub); font-size:11px; font-weight:bold;
    }
    @media (max-width: 600px) {
      .theory-pipeline { 
        flex-direction: column; 
        align-items: stretch; 
        gap: 8px; 
        padding: 14px; 
      }
      .theory-pipeline span { 
        text-align: center; 
        font-size: 12px; 
        white-space: normal; /* ã‚¹ãƒãƒ›ã§ã¯æ”¹è¡Œè¨±å¯ */
      }
      .pipeline-arrow { 
        transform: rotate(90deg); 
        align-self: center; 
        margin: 0; 
        height: 14px;
      }
      .pipeline-label { margin-bottom: 4px; }
    }

    /* --- ã‚»ã‚¯ã‚·ãƒ§ãƒ³è¦‹å‡ºã— --- */
    .section-header {
      margin-top: 50px;
      margin-bottom: 16px;
      padding-bottom: 12px;
      border-bottom: 1px solid rgba(43,43,43,0.08);
    }
    .section-title {
      font-size: 20px;
      font-weight: 700;
      color: var(--text-ink);
      position: relative;
      padding-left: 14px;
      margin-bottom: 10px;
      display: flex;
      align-items: center;
    }
    .section-title::before {
      content: "";
      position: absolute;
      left: 0;
      top: 4px;
      bottom: 4px;
      width: 4px;
      background: var(--color-indigo);
      border-radius: 2px;
    }
    .section-desc {
      font-size: 14px;
      color: var(--text-sub);
      line-height: 1.7;
      padding-left: 14px;
    }
    @media (max-width: 600px) {
      .section-header { margin-top: 40px; padding-left: 0; padding-bottom: 10px; }
      .section-title { font-size: 18px; padding-left: 10px; }
      .section-title::before { width: 3px; }
      .section-desc { padding-left: 0; font-size: 13px; text-align: justify; }
    }
    .highlight-text {
      color: var(--color-vermilion);
      background: rgba(181, 73, 56, 0.08);
      padding: 0 4px;
      font-weight: 600;
      border-radius: 2px;
      display: inline-block; /* è¡Œã®é€”ä¸­ã§åˆ‡ã‚Œãªã„ã‚ˆã†ã« */
    }

    /* --- ãƒ‘ãƒãƒ« --- */
    .panels {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 24px;
    }
    .panels-single {
      grid-template-columns: 1fr;
    }
    @media (max-width: 768px) {
      .panels { grid-template-columns: 1fr; gap: 24px; }
    }

    .panel {
      background: var(--bg-panel);
      border: 1px solid rgba(43, 43, 43, 0.1);
      border-radius: 6px;
      padding: 20px;
      position: relative;
      overflow: hidden;
      box-shadow: 0 2px 8px rgba(0,0,0,0.02);
      transition: box-shadow 0.3s;
    }
    @media (max-width: 600px) {
      .panel { padding: 16px; }
    }
    
    .panel-head {
      display: flex;
      justify-content: space-between;
      align-items: flex-end;
      margin-bottom: 14px;
      border-bottom: 1px dotted rgba(43, 43, 43, 0.2);
      padding-bottom: 8px;
      gap: 8px;
    }
    @media (max-width: 600px) {
      .panel-head {
        flex-direction: column;
        align-items: flex-start;
        gap: 6px;
      }
    }

    .panel-label {
      font-size: 12px;
      font-weight: 700;
      letter-spacing: 0.05em;
      color: var(--text-ink);
      display: flex;
      align-items: center;
      gap: 6px;
      white-space: nowrap;
    }
    .panel-label::before {
      content: "";
      display: block;
      width: 10px;
      height: 10px;
      border-radius: 50%;
      flex-shrink: 0;
    }
    .label-inf::before { background: var(--color-indigo); }
    .label-fin::before { background: var(--color-purple); }
    .label-led::before { background: var(--color-matcha); }

    .panel-msg {
      font-size: 11px;
      color: var(--text-sub);
      text-align: right;
      line-height: 1.4;
      flex: 1; 
    }
    @media (max-width: 600px) {
      .panel-msg { 
        text-align: left; 
        font-size: 11px;
        width: 100%;
      }
    }

    .canvas-box {
      width: 100%;
      height: 260px;
      background: #fff;
      position: relative;
      overflow: hidden;
      border: 1px solid rgba(0,0,0,0.05);
      border-radius: 2px;
    }
    @media (max-width: 600px) {
      .canvas-box { height: 220px; }
    }

    canvas { width: 100%; height: 100%; display: block; }
    
    .overlay-badge {
      position: absolute;
      bottom: 8px;
      right: 8px;
      font-size: 10px;
      padding: 4px 8px;
      background: rgba(255, 255, 255, 0.95);
      border: 1px solid rgba(43, 43, 43, 0.15);
      color: var(--text-ink);
      box-shadow: 0 2px 6px rgba(0,0,0,0.05);
      pointer-events: none;
      font-family: monospace;
      border-radius: 4px;
      white-space: nowrap;
    }
    .goal-caption {
      margin-top: 8px;
      font-size: 11px;
      color: var(--color-indigo);
      text-align: right;
      font-weight: 500;
      line-height: 1.4;
    }
    @media (max-width: 600px) {
      .goal-caption { text-align: left; }
    }

    /* --- ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ãƒãƒ¼ --- */
    .sec2-controls {
      margin: 24px 0 32px;
      padding: 20px;
      border-radius: 6px;
      background: #fff;
      border: 1px solid rgba(30, 63, 102, 0.15);
      box-shadow: 0 4px 12px rgba(30, 63, 102, 0.03);
    }
    @media (max-width: 600px) {
      .sec2-controls { padding: 16px; margin: 16px 0 24px; }
    }

    .sec2-ctrl-label {
      font-size: 13px;
      color: var(--text-ink);
      margin-bottom: 16px;
      font-weight: 500;
      line-height: 1.6;
    }
    .sec2-ctrl-row {
      display: flex;
      align-items: center;
      gap: 20px;
      flex-wrap: wrap;
      margin-bottom: 20px;
    }
    @media (max-width: 600px) {
      .sec2-ctrl-row { gap: 12px; margin-bottom: 16px; }
    }
    
    .kernel-mode-row {
      display: flex;
      align-items: center;
      gap: 12px;
      flex: 1;
      min-width: 260px; /* æŠ˜ã‚Šè¿”ã—åˆ¶å¾¡ */
    }
    .kernel-mode-label {
      font-size: 12px;
      font-weight: 700;
      color: var(--text-sub);
      white-space: nowrap;
    }
    .kernel-select {
      flex: 1;
      padding: 10px 12px;
      border: 1px solid rgba(43, 43, 43, 0.3);
      border-radius: 4px;
      background: #fdfdfa;
      color: var(--text-ink);
      font-family: inherit;
      font-size: 13px; /* iOS zoomé˜²æ­¢ */
      cursor: pointer;
      -webkit-appearance: none;
      appearance: none;
      background-image: url("data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22292.4%22%20height%3D%22292.4%22%3E%3Cpath%20fill%3D%22%23333%22%20d%3D%22M287%2069.4a17.6%2017.6%200%200%200-13-5.4H18.4c-5%200-9.3%201.8-12.9%205.4A17.6%2017.6%200%200%200%200%2082.2c0%205%201.8%209.3%205.4%2012.9l128%20127.9c3.6%203.6%207.8%205.4%2012.8%205.4s9.2-1.8%2012.8-5.4L287%2095c3.5-3.5%205.4-7.8%205.4-12.8%200-5-1.9-9.2-5.5-12.8z%22%2F%3E%3C%2Fsvg%3E");
      background-repeat: no-repeat;
      background-position: right 12px top 50%;
      background-size: 10px auto;
    }
    @media (max-width: 600px) {
      .kernel-select { font-size: 14px; }
    }

    .sec2-slider {
      flex: 1;
      min-width: 220px;
      display: flex;
      align-items: center;
      gap: 12px;
    }
    input[type="range"] {
      -webkit-appearance: none;
      width: 100%;
      height: 4px; 
      background: rgba(43, 43, 43, 0.15);
      border-radius: 2px;
      outline: none;
    }
    input[type="range"]::-webkit-slider-thumb {
      -webkit-appearance: none;
      width: 24px;
      height: 24px;
      border-radius: 50%;
      background: #fff;
      border: 2px solid var(--color-indigo);
      cursor: pointer;
      box-shadow: 0 2px 5px rgba(0,0,0,0.2);
    }
    .sec2-slider-value {
      font-size: 12px;
      font-family: monospace;
      color: var(--color-indigo);
      white-space: nowrap;
      min-width: 65px;
      text-align: right;
    }

    /* 3æ¡ä»¶ãƒ©ãƒ³ãƒ— */
    .cond-lamps {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      padding-top: 16px;
      border-top: 1px solid rgba(43,43,43,0.1);
      width: 100%;
    }
    .cond-lamp {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      padding: 8px 12px; /* ã‚¿ãƒƒãƒ—ã—ã‚„ã™ã„é«˜ã• */
      border-radius: 20px;
      background: #f5f5f5;
      border: 1px solid rgba(0,0,0,0.1);
      font-size: 11px;
      color: var(--text-sub);
      transition: all 0.4s ease;
      flex: 1;
      min-width: 130px; 
      white-space: nowrap;
    }
    .cond-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: #ccc;
      flex-shrink: 0;
    }
    .cond-ok {
      background: #f0fdf4;
      border-color: var(--color-matcha);
      color: var(--color-matcha);
      font-weight: 600;
    }
    .cond-ok .cond-dot { background: var(--color-matcha); }
    .cond-fail {
      background: #fff5f5;
      border-color: var(--color-vermilion);
      color: var(--color-vermilion);
    }
    .cond-fail .cond-dot { background: var(--color-vermilion); }
    .cond-partial {
      background: #fffcf0;
      border-color: var(--color-gold);
      color: #9c7c2e;
    }
    .cond-partial .cond-dot { background: var(--color-gold); }

    /* èª¤å·®è¡¨ç¤º */
    .sec2-error-row {
      margin-top: 12px;
      width: 100%;
      display: flex;
      gap: 20px;
      font-size: 11px;
      color: var(--text-sub);
      flex-wrap: wrap;
    }
    @media (max-width: 600px) {
      .sec2-error-row { flex-direction: column; gap: 8px; }
    }
    .error-value {
      font-family: monospace;
      font-weight: 700;
      margin-left: 4px;
      font-size: 12px;
    }
    .error-safe { color: var(--color-matcha); }
    .error-unsafe { color: var(--color-vermilion); }

    /* ãƒã‚¢ãƒ³ã‚«ãƒ¬æ³¨é‡ˆã¨ã‚¨ã‚­ã‚¹ãƒ‘ãƒ¼ãƒˆãƒœã‚¿ãƒ³ */
    .poincare-note {
      margin-top: 20px;
      padding: 16px;
      background: rgba(30, 63, 102, 0.04);
      border-left: 4px solid var(--color-purple);
      border-radius: 4px;
      font-size: 12px;
      color: var(--color-indigo);
      display: flex;
      flex-direction: column;
      gap: 16px;
    }
    @media (min-width: 600px) {
      .poincare-note { 
        flex-direction: row; 
        justify-content: space-between; 
        align-items: center; 
      }
    }
    
    .expert-btn-group {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      width: 100%;
    }
    @media (min-width: 600px) {
      .expert-btn-group { width: auto; }
    }

    .expert-btn {
      background: #fff;
      border: 1px solid var(--color-purple);
      color: var(--color-purple);
      padding: 10px 14px; /* ã‚¿ãƒƒãƒ—é ˜åŸŸç¢ºä¿ */
      border-radius: 4px;
      font-size: 12px;
      font-family: inherit;
      cursor: pointer;
      transition: all 0.2s;
      box-shadow: 0 2px 5px rgba(106, 76, 156, 0.1);
      flex: 1; /* ã‚¹ãƒãƒ›ã§ãƒœã‚¿ãƒ³ã‚’æ¨ªå¹…ã„ã£ã±ã„ã« */
      text-align: center;
      white-space: nowrap;
    }
    .expert-btn:active { transform: translateY(1px); box-shadow: none; }
    .expert-btn-sub {
      border-color: var(--color-indigo);
      color: var(--color-indigo);
    }

    /* å°å¸³ãƒ­ãƒƒã‚¯çŠ¶æ…‹ */
    .ledger-panel {
      position: relative;
      transition: box-shadow 0.6s ease, border-color 0.6s ease;
    }
    .ledger-panel.locked {
      background: #f9f9f9;
      border-style: dashed;
    }
    .ledger-panel.locked::before {
      content: "ğŸ”’ æ¡ä»¶æœªé”æˆ\AYukawaÃ—FejÃ©r ã§ Îµ_safe ã‚’æº€ãŸã™ã¨\Aå°å¸³ãŒç”Ÿæˆã•ã‚Œã¾ã™";
      white-space: pre-wrap; /* æ”¹è¡Œ */
      position: absolute;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      background: rgba(255,255,255,0.85);
      backdrop-filter: blur(2px);
      z-index: 10;
      font-size: 13px;
      color: var(--text-sub);
      font-weight: 600;
      text-align: center;
      line-height: 1.8;
      padding: 20px;
    }
    .ledger-panel.locked .ledger-table,
    .ledger-panel.locked .ledger-context {
      opacity: 0.1;
      filter: blur(2px);
    }
    
    @keyframes unlockGlow {
      0% { box-shadow: 0 0 0 rgba(92, 122, 71, 0); border-color: rgba(43,43,43,0.1); }
      50% { box-shadow: 0 0 30px rgba(92, 122, 71, 0.4); border-color: var(--color-matcha); background: #fffcfc; }
      100% { box-shadow: 0 2px 15px rgba(0,0,0,0.05); border-color: rgba(43,43,43,0.1); background: #fff; }
    }
    .ledger-unlocked-anim {
      animation: unlockGlow 1.5s ease-out;
    }

    /* å°å¸³ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆ */
    .ledger-context {
      margin-bottom: 16px;
      font-size: 12px;
      color: var(--text-ink);
      padding: 10px 14px;
      background: rgba(220, 220, 220, 0.2);
      border-left: 3px solid var(--color-matcha);
      line-height: 1.6;
    }
    .highlight-poincare { color: var(--color-purple); font-weight: 700; white-space: nowrap; }
    .highlight-kernel { color: var(--color-indigo); font-weight: 700; white-space: nowrap; }
    .highlight-sigma { color: var(--color-matcha); font-weight: 700; white-space: nowrap; }

    /* å°å¸³ãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆæ¨ªã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«å¯¾å¿œï¼‰ */
    .ledger-wrap {
      overflow-x: auto;
      -webkit-overflow-scrolling: touch;
      padding-bottom: 10px;
    }
    .ledger-table {
      width: 100%;
      border-collapse: collapse;
      font-size: 12px;
      white-space: nowrap;
      min-width: 500px;
    }
    .ledger-table th {
      text-align: left;
      color: var(--color-indigo);
      font-weight: 700;
      padding: 10px 12px; /* ã‚¿ãƒƒãƒ—ã—ã‚„ã™ã„é«˜ã• */
      border-bottom: 2px solid var(--color-indigo);
      background: #fff;
    }
    .ledger-table td {
      padding: 10px 12px;
      color: var(--text-ink);
      border-bottom: 1px solid rgba(0,0,0,0.06);
      font-family: monospace;
    }
    tr.active-row {
      background: rgba(92, 122, 71, 0.08);
    }
    .check-ok {
      color: var(--color-matcha);
      font-weight: 700;
    }
    .num-col { text-align: right; }

    /* ãƒ¢ãƒ¼ãƒ€ãƒ«å…±é€šï¼ˆç™½åœ°ãƒ™ãƒ¼ã‚¹ãƒ»ã‚¹ãƒãƒ›å¯¾å¿œï¼‰ */
    .modal-overlay {
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(5px);
      z-index: 1000;
      display: flex;
      align-items: flex-end; /* ã‚¹ãƒãƒ›ã§ã¯ä¸‹å¯„ã›ï¼ˆæ“ä½œã—ã‚„ã™ã„ï¼‰ */
      justify-content: center;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.3s ease;
    }
    @media (min-width: 600px) {
      .modal-overlay { align-items: center; background: rgba(255, 255, 255, 0.85); }
    }
    
    .modal-overlay.open {
      opacity: 1;
      pointer-events: auto;
    }
    .modal-content {
      background: #fff;
      border: 1px solid rgba(0,0,0,0.1);
      box-shadow: 0 -10px 40px rgba(30, 63, 102, 0.15);
      border-radius: 16px 16px 0 0;
      width: 100%;
      height: 90vh;
      max-width: 800px;
      overflow-y: auto;
      padding: 30px 20px 80px; /* ä¸‹ä½™ç™½å¤šã‚ï¼ˆæŒ‡ã§éš ã‚Œãªã„ã‚ˆã†ï¼‰ */
      position: relative;
      transform: translateY(100%);
      transition: transform 0.3s cubic-bezier(0.16, 1, 0.3, 1);
      color: var(--text-ink);
    }
    @media (min-width: 600px) {
      .modal-content {
        width: 90%;
        height: auto;
        max-height: 85vh;
        border-radius: 8px;
        padding: 40px;
        box-shadow: 0 10px 50px rgba(30, 63, 102, 0.2);
        transform: translateY(20px);
      }
    }
    
    .modal-overlay.open .modal-content {
      transform: translateY(0);
    }
    .modal-close {
      position: sticky;
      top: 0;
      float: right;
      background: rgba(255,255,255,0.9);
      border: 1px solid rgba(0,0,0,0.1);
      border-radius: 50%;
      width: 40px;
      height: 40px;
      color: var(--text-sub);
      font-size: 24px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 10px;
      z-index: 100;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    
    .modal-header {
      font-size: 20px;
      font-weight: 700;
      color: var(--color-indigo);
      margin-bottom: 24px;
      border-bottom: 2px solid var(--color-indigo);
      padding-bottom: 12px;
      text-align: center;
      letter-spacing: 0.05em;
      clear: both;
      line-height: 1.4;
    }
    .modal-body {
      font-size: 14px;
      line-height: 1.9;
      text-align: justify;
    }
    .modal-section { margin-bottom: 30px; }
    .modal-section-title {
      font-size: 16px;
      font-weight: 700;
      color: var(--color-indigo);
      margin-bottom: 10px;
      padding-left: 10px;
      border-left: 4px solid var(--color-indigo);
    }
    .modal-tag {
      background: var(--color-indigo);
      color: #fff;
      padding: 2px 6px;
      border-radius: 2px;
      font-size: 11px;
      font-weight: normal;
      margin-right: 6px;
      vertical-align: middle;
      display: inline-block;
    }
    .modal-math-block {
      background: #f9f9f9;
      padding: 16px;
      border-radius: 4px;
      margin: 16px 0;
      border: 1px solid rgba(0,0,0,0.05);
      font-family: "Times New Roman", serif;
      overflow-x: auto;
    }
    .modal-ref-list {
      margin-top: 40px;
      border-top: 1px solid rgba(0,0,0,0.1);
      padding-top: 20px;
      font-size: 11px;
      color: var(--text-sub);
    }
    .modal-ref-list ul { padding-left: 16px; margin-top: 8px; }
    .modal-ref-list li { margin-bottom: 6px; }

    /* ãƒ•ãƒƒã‚¿ãƒ¼ */
    .footer-msg {
      margin-top: 60px;
      text-align: center;
      font-size: 14px;
      font-weight: 500;
      color: var(--text-ink);
      opacity: 0.8;
      line-height: 2.2;
      font-feature-settings: "palt";
    }
  </style>
</head>
<body>

<div class="wrapper">
  
  <div class="header-area">
    <div class="title-main">æ¹¯å·ãƒãƒ†ãƒ³ã‚·ãƒ£ãƒ«ã‹ã‚‰<br>å§‹ã‚ã‚‹ç´ æ•°è¨ˆç®—ã®å¿ƒè‡“éƒ¨</div>
    <div class="title-sub">
      ç´ æ•°ã‚’ã€Œã©ã“ã¾ã§æ•°ãˆã‚Œã°ã€ã‚‚ã†ååˆ†ã¨è¨€ãˆã‚‹ã‹ã€ã€‚ãã®å•ã„ã«æ­£é¢ã‹ã‚‰ç­”ãˆã‚‹ãŸã‚ã«ã€ã¾ãšå€Ÿã‚Šã¦ãã‚‹ã®ãŒæ¹¯å·ç§€æ¨¹ã®ç™ºæƒ³ã§ã™ã€‚
      ç„¡é™ã«é•·ãå°¾ã‚’å¼•ãåŠ›ã®ä»£ã‚ã‚Šã«ã€ã€Œã‚ã‚‹è·é›¢ã®å¤–å´ã§ã¯ã»ã¨ã‚“ã©ä½•ã‚‚èµ·ããªã„å ´ã€ã‚’å°å…¥ã™ã‚‹ã€‚
      ã“ã®æ¹¯å·ãƒãƒ†ãƒ³ã‚·ãƒ£ãƒ«ã®ä¸–ç•Œè¦³ãŒã‚ã‚‹ã‹ã‚‰ã“ãã€ç´ æ•°ã®ä¸–ç•Œã«ã‚‚ã€Œã“ã“ã¾ã§è¦‹ã‚Œã°ã€ãã®å…ˆã¯é™ã‹ã ã€ã¨ã„ã†å¢ƒç•Œç·šã‚’ä¸€æœ¬å¼•ãã“ã¨ãŒã§ãã¾ã™ã€‚
      ãã®å¢ƒç•Œç·šã‚’ã¤ãã‚‹ä»•æ›ã‘ãŒã€ã“ã®ãƒ‡ãƒ¢ã§è¦‹ãˆã‚‹æ ¸ã§ã‚ã‚Šã€ã®ã¡ã«ç´ æ•°è¨ˆç®—OSã®å¿ƒè‡“éƒ¨ã«ãªã‚‹éƒ¨åˆ†ã§ã™ã€‚
      ãã—ã¦ã€ã“ã®ã€Œæœ‰é™ãªç¯„å›²ã ã‘ã§è¨€ã„åˆ‡ã‚‹ã€ã¨ã„ã†è€ƒãˆæ–¹ã‚’ã€åƒ•ã‚‰ã¯ã‚ã¨ã§<strong>æœ‰é™é–‰åŒ…</strong>ã¨å‘¼ã³ã¾ã™ã€‚
    </div>
  </div>

  <!-- ã‚¹ãƒ†ãƒƒãƒ—ã‚¬ã‚¤ãƒ‰ -->
  <div class="step-guide">
    <div class="step-card">
      <span class="step-num">STEP 1</span>
      <span class="step-text">å ´ï¼šYukawa ãƒãƒ†ãƒ³ã‚·ãƒ£ãƒ«ã§ã€Œã©ã“ã¾ã§å½±éŸ¿ã‚’è¨±ã™ã‹ã€ã‚’æ±ºã‚ã‚‹</span>
    </div>
    <div class="step-card">
      <span class="step-num">STEP 2</span>
      <span class="step-text">ç´šæ•°ï¼šãã®å ´ã®ä¸Šã§èª¤å·®ã«åå‰ã‚’ä»˜ã‘ã€Îµ_safe ã¾ã§è²¬ä»»ã‚’å–ã‚‹</span>
    </div>
    <div class="step-card">
      <span class="step-num">STEP 3</span>
      <span class="step-text">å°å¸³ï¼šã©ã“ã¾ã§è¦‹ãŸã‹ã‚’è¡Œã”ã¨ã«æ®‹ã™ã€Œç§‘å­¦ã®è‰¯å¿ƒã€ã®è¨˜éŒ²</span>
    </div>
  </div>

  <!-- ç†è«–ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ -->
  <div class="theory-pipeline">
    <div class="pipeline-label">THEORY FLOW:</div>
    <span>Yukawa ãƒãƒ†ãƒ³ã‚·ãƒ£ãƒ«</span>
    <div class="pipeline-arrow">â†“</div>
    <span>YukawaÃ—FejÃ©r æœ‰é™é–‰åŒ…</span>
    <div class="pipeline-arrow">â†“</div>
    <span>Î£â‚ å°å¸³ï¼ˆGhostDrift ADICï¼‰</span>
  </div>

  <!-- ã‚»ã‚¯ã‚·ãƒ§ãƒ³1 -->
  <div class="section-header">
    <div class="section-title">1. ä¸–ç•Œã®è¦‹ãˆæ–¹ã®é•ã„</div>
    <div class="section-desc">
      å·¦å³åŒã˜ <span class="highlight-text">Î¼ï¼ˆåˆ°é”è·é›¢ï¼‰</span>ã§å‹è² ã—ã¦ãã ã•ã„ã€‚<br>
      å·¦ã¯æ•™ç§‘æ›¸ã§ãŠãªã˜ã¿ã® 1/rã€å³ã¯æ¹¯å·ãŒå°å…¥ã—ãŸ $V(r)=e^{-\mu r}/r$ ã§ã™ã€‚<br>
      1/r ã®ä¸–ç•Œã§ã¯ã€ã©ã‚Œã ã‘ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’ã„ã˜ã£ã¦ã‚‚ã€Œå®Œå…¨ãªé™å¯‚ï¼ˆ0ï¼‰ã€ã«ã¯ãªã‚Šã¾ã›ã‚“ã€‚<br>
      Yukawa ãƒãƒ†ãƒ³ã‚·ãƒ£ãƒ«ã®ä¸–ç•Œã§ã¯ã€ã‚ã‚‹åŠå¾„ã®å¤–å´ã«ã€Œæœ¬å½“ã«ã»ã¨ã‚“ã©ä½•ã‚‚èµ·ããªã„é ˜åŸŸã€ãŒç¾ã‚Œã¾ã™ã€‚<br>
      ã“ã®ã€Œæœ‰é™ãªé™ã‘ã•ã€ã‚’ã€ãã®ã¾ã¾æœ‰é™é–‰åŒ…OSã®è¨­è¨ˆåŸç†ã«ã—ã¦ã„ã‚‹ã€ã¨ã„ã†ã®ãŒã“ã®ãƒ‡ãƒ¢ã®å‡ºç™ºç‚¹ã§ã™ã€‚
    </div>
  </div>

  <div class="section-controls">
    <div class="control-bar">
      <div class="control-label">Î¼ ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã§ã€Œå ´ãŒã©ã“ã¾ã§å±Šãã‹ã€ã‚’å¤‰ãˆã¦ã¿ã¦ãã ã•ã„ã€‚</div>
      <div class="control-row">
        <input type="range" id="mu-slider" min="0.5" max="2.5" step="0.1" value="1.2">
        <div class="control-value">Î¼=<span id="mu-value">1.2</span></div>
      </div>
    </div>
  </div>

  <div class="panels">
    <!-- å·¦ï¼šç„¡é™ -->
    <div class="panel panel-infinite">
      <div class="panel-head">
        <span class="panel-label label-inf">å¾“æ¥ã®ç‰©ç†ï¼ˆç„¡é™ï¼‰</span>
        <span class="panel-msg">1/r ã®æ³¢ç´‹<br>ç„¡é™é ã¾ã§æ®‹ã‚‹</span>
      </div>
      <div class="canvas-box">
        <canvas id="cvs-field-inf"></canvas>
        <div class="overlay-badge">å½±éŸ¿ï¼šç„¡é™</div>
      </div>
    </div>
    <!-- å³ï¼šæœ‰é™ -->
    <div class="panel panel-finite">
      <div class="panel-head">
        <span class="panel-label label-fin">GhostDriftï¼ˆæœ‰é™ï¼‰</span>
        <span class="panel-msg">Yukawa ãƒãƒ†ãƒ³ã‚·ãƒ£ãƒ«<br>æ€¥æ¿€ã«æ¸›è¡°</span>
      </div>
      <div class="canvas-box">
        <canvas id="cvs-field-fin"></canvas>
        <div class="overlay-badge">å½±éŸ¿ï¼šæœ‰é™ã§åœæ­¢</div>
      </div>
      <!-- ã‚´ãƒ¼ãƒ«æ˜ç¤º -->
      <div class="goal-caption">ç ´ç·šã®å††ã‚ˆã‚Šå¤–å´ã§ã¯ã€Yukawa ã®åŠ›ã¯ã€Œ0 ã¨ã¿ãªã›ã‚‹ã€ã¾ã§è½ã¡ã¾ã™ã€‚</div>
    </div>
  </div>

  <!-- ã‚»ã‚¯ã‚·ãƒ§ãƒ³2 -->
  <div class="section-header">
    <div class="section-title">2. è¨ˆç®—é‡ã®é•ã„</div>
    <div class="section-desc">
      æœ‰é™é–‰åŒ…ã®æœ¬å½“ã®é›£ã—ã•ã¯ã€ãŸã é€”ä¸­ã§åˆ‡ã‚‹ã“ã¨ã§ã¯ãªãã€
      <span class="highlight-text">ã€Œã©ã“ã§åˆ‡ã‚Œã°çœŸå€¤ã‹ã‚‰å¤–ã‚Œãªã„ã‹ã€</span>ã‚’æ•°å­¦ã®å´ã§è¨€ã„åˆ‡ã‚‹ã“ã¨ã«ã‚ã‚Šã¾ã™ã€‚<br>
      æ¹¯å·ãŒå ´ã®ç›´è¦³ã‚’æ–¹ç¨‹å¼ã«ã¾ã§è½ã¨ã—è¾¼ã‚“ã ã‚ˆã†ã«ã€
      ã“ã“ã§ã¯ã€Œæœ‰é™ã«å±Šãå ´ã€ã®ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ã€ãã®ã¾ã¾èª¤å·®ä¸ç­‰å¼ $\varepsilon \le \varepsilon_{\text{safe}}$ ã«å¤‰æ›ã—ã¦ã„ã¾ã™ã€‚
    </div>
  </div>

  <div class="sec2-controls">
    <div class="sec2-ctrl-label">
      ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã§æœ‰é™çª“ N ã‚’å‹•ã‹ã—ã¦ã€èª¤å·®ãŒ <span class="highlight-text">Îµ_safe = 0.02</span> ã‚’ä¸‹å›ã‚‹ã‹ã©ã†ã‹ã‚’ä½“é¨“ã—ã¦ãã ã•ã„ã€‚
    </div>
    <div class="sec2-ctrl-row">
      <div class="kernel-mode-row">
        <div class="kernel-mode-label">ã‚«ãƒ¼ãƒãƒ«</div>
        <select id="kernel-select" class="kernel-select">
          <option value="naive">Naive cutï¼ˆãŸã é€”ä¸­ã§åˆ‡ã‚‹ï¼‰</option>
          <option value="gauss">Gaussianï¼ˆãªã‚ã‚‰ã‹ã«æ¸›è¡°ï¼‰</option>
          <option value="fejer">FejÃ©r-onlyï¼ˆè§£æçš„ã«ã¯ãã‚Œã„ï¼‰</option>
          <option value="yukawa">Yukawa-onlyï¼ˆç‰©ç†çš„ã«æœ‰é™ä½œç”¨ï¼‰</option>
          <option value="yukawaFejer" selected>YukawaÃ—FejÃ©rï¼ˆæœ‰é™é–‰åŒ…ã‚«ãƒ¼ãƒãƒ«ï¼‰</option>
        </select>
      </div>
      
      <div class="sec2-slider">
        <input type="range" id="cutoff-slider" min="5" max="40" value="16">
        <div class="sec2-slider-value">N=<span id="cutoff-value">16</span><br>Îµ_safe=0.02</div>
      </div>
    </div>
    
    <!-- 3æ¡ä»¶ãƒ©ãƒ³ãƒ— -->
    <div class="cond-lamps">
      <div class="cond-lamp cond-ok" id="lamp-range">
        <span class="cond-dot"></span>
        <span class="cond-label">æœ‰é™ä½œç”¨</span>
      </div>
      <div class="cond-lamp cond-fail" id="lamp-truth">
        <span class="cond-dot"></span>
        <span class="cond-label">çœŸå€¤ä¿è¨¼</span>
      </div>
      <div class="cond-lamp cond-fail" id="lamp-sigma">
        <span class="cond-dot"></span>
        <span class="cond-label">Î£â‚ å°å¸³åŒ–</span>
      </div>
    </div>
    
    <!-- å¥¥ç¾©æ³¨é‡ˆã¨ä¸Šç´šè€…ãƒœã‚¿ãƒ³ -->
    <div class="poincare-note">
      <div>
        â€» YukawaÃ—FejÃ©r ã¯ã€è§£æä¸–ç•Œã‚’ãƒã‚¢ãƒ³ã‚«ãƒ¬çš„ã«ã€æœ‰é™ãªå®‡å®™ã€ã¨ã—ã¦é–‰ã˜ã¦ã‹ã‚‰ã§ãªã„ã¨å‡ºã¦ã“ãªã„ç‰¹ç•°ç‚¹ã§ã™ã€‚<br>
        ç„¡é™ã®å…ˆã¾ã§è²¬ä»»ã‚’è² ã†ã®ã§ã¯ãªãã€ã€Œã“ã“ã¾ã§ã‚’è¦‹ã‚‹ã€ã¨å®‡å®™ã®å¤§ãã•ã‚’æ±ºã‚ãŸã†ãˆã§ã€<br>
        ãã®ç¯„å›²ã®ä¸­ã ã‘ã¯èª¤é­”åŒ–ã•ãšã«è¨¼æ˜ã™ã‚‹â”€â”€æ¹¯å·çš„ãªã€Œç§‘å­¦ã¨è‰¯å¿ƒã€ã®ä½ç½®æ±ºã‚ã‚’ã€ãã®ã¾ã¾æ•°å¼ã«ã—ãŸã‚‚ã®ã§ã™ã€‚
      </div>
      <div class="expert-btn-group">
        <button class="expert-btn" id="expert-open-btn">ãªãœå›°é›£ã ã£ãŸã®ã‹ï¼Ÿ</button>
        <button class="expert-btn expert-btn-sub" id="yukawa-open-btn">æœ‰é™æ€§ã¨æ¹¯å·ç§€æ¨¹</button>
      </div>
    </div>

    <div class="sec2-error-row">
      <div>Naive èª¤å·®ï¼š<span id="err-naive" class="error-value error-unsafe">--</span></div>
      <div>æœ‰é™é–‰åŒ… èª¤å·®ï¼š<span id="err-finite" class="error-value">--</span></div>
    </div>
  </div>

  <div class="panels">
    <!-- å·¦ï¼šç„¡é™ç´šæ•° -->
    <div class="panel panel-infinite">
      <div class="panel-head">
        <span class="panel-label label-inf">Naive Cut</span>
        <span class="panel-msg">ã©ã“ã¾ã§ã„ã£ã¦ã‚‚ä½™å‰°æˆåˆ† E_X ãŒ<br>æ¶ˆãˆãšã«æ®‹ã‚Šç¶šã‘ã‚‹</span>
      </div>
      <div class="canvas-box">
        <canvas id="cvs-series-inf"></canvas>
        <div class="overlay-badge">èª¤å·®ãŒæ¶ˆãˆãªã„</div>
      </div>
    </div>
    <!-- å³ï¼šæœ‰é™é–‰åŒ… -->
    <div class="panel panel-finite">
      <div class="panel-head">
        <span class="panel-label label-fin">Selected</span>
        <span class="panel-msg">æœ‰é™é–‰åŒ…ã‚«ãƒ¼ãƒãƒ«è¨­è¨ˆ<br>æ¡ä»¶ã‚’æº€ãŸã›ã‚‹ã‹ï¼Ÿ</span>
      </div>
      <div class="canvas-box">
        <canvas id="cvs-series-fin"></canvas>
        <div class="overlay-badge">ã“ã“ã§é–‰ã˜ã‚‹</div>
      </div>
    </div>
  </div>

  <!-- ã‚»ã‚¯ã‚·ãƒ§ãƒ³3 -->
  <div class="section-header">
    <div class="section-title">3. è¨¼æ˜ã®ç°¡æ½”ã•</div>
    <div class="section-desc">
      æœ‰é™é–‰åŒ…ãŒæˆç«‹ã—ãŸã¨ãã ã‘ã€ã“ã®å°å¸³ãŒå‹•ãå‡ºã—ã¾ã™ã€‚<br>
      ã€Œé€”ä¸­ã§åˆ‡ã‚Šã¾ã—ãŸã€‚ã§ã‚‚å¤§ä¸ˆå¤«ãã†ã§ã™ã€ã¨ã„ã†æ„Ÿè¦šçš„ãªåˆ¤æ–­ã§ã¯ã€
      ãã‚‚ãã‚‚æ•´æ•°è¨¼æ˜ï¼ˆÎ£â‚ï¼‰ã®åœŸä¿µã«ã™ã‚‰ä¸ŠãŒã‚Œã¾ã›ã‚“ã€‚<br>
      æ¹¯å·ãŒæ ¸åŠ›ã‚’ã€Œæœ‰é™è·é›¢ã«é–‰ã˜è¾¼ã‚ãŸå ´ã€ã§æ›¸ãç›´ã—ãŸã‚ˆã†ã«ã€
      ã“ã“ã§ã¯è§£æã¨èª¤å·®ã‚’ã€Œæœ‰é™å€‹ã®æ•´æ•°ä¸ç­‰å¼ã€ã«é–‰ã˜è¾¼ã‚ã€ãã®å…¨éƒ¨ã‚’è¨˜éŒ²ã¨ã—ã¦æ®‹ã—ã¾ã™ã€‚
    </div>
  </div>

  <div class="panels panels-single">
    <!-- åˆæœŸçŠ¶æ…‹ã¯ãƒ­ãƒƒã‚¯ã•ã‚Œã¦ã„ã‚‹ -->
    <div class="panel panel-finite ledger-panel locked" id="ledger-panel">
      <div class="panel-head">
        <span class="panel-label label-led">Î£â‚ å°å¸³</span>
        <span class="panel-msg">GhostDrift ADIC å½¢å¼<br>æœ‰é™çª“å†…ã‚’æ•´æ•°ãƒã‚§ãƒƒã‚¯ã™ã‚‹ã ã‘ã§OK</span>
      </div>

      <!-- å°å¸³ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆ -->
      <div class="ledger-context">
        ã“ã®å°å¸³ã¯ã€<span class="highlight-poincare">æœ‰é™é–‰åŒ…</span> â†’ 
        <span class="highlight-kernel">YukawaÃ—FejÃ©r</span> â†’ 
        <span class="highlight-sigma">æœ‰ç†æ•°ä¸Šä¸‹ç•Œ</span><br>
        ã¨ã„ã† 3 ã¤ã®æ–­çµ¶ã‚’ã™ã¹ã¦è¶ŠãˆãŸå…ˆã«ç¾ã‚Œã‚‹ã€Œè‰¯å¿ƒã®å¸³ç°¿ã€ã§ã™ã€‚<br>
        ä¸€åº¦æ±ºã‚ãŸæœ‰é™çª“ã®ä¸­ã ã‘ã‚’è¦‹ã¦ã€ãã“ã§ã®ä¸»é …ã¨èª¤å·®ã‚’ã™ã¹ã¦æ•´æ•°ã§æ•°ãˆä¸Šã’ã€<br>
        ã€Œã“ã®è¡Œæ•°ã¾ã§ã¯æœ¬å½“ã«è‡ªåˆ†ã§è¦‹ãŸã€ã¨ã„ã†äº‹å®Ÿã ã‘ã‚’ Î£â‚ ã¨ã—ã¦æ®‹ã—ã¾ã™ã€‚
      </div>

      <div class="comparison-area">
        <table class="comp-table">
          <thead>
            <tr>
              <th>æ¡ä»¶</th>
              <th>å¾“æ¥</th>
              <th>GhostDrift</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>æœ‰é™è·é›¢ã§å½±éŸ¿åœæ­¢</td>
              <td><span class="status-mid">â–³</span></td>
              <td><span class="status-ok">â—</span></td>
            </tr>
            <tr>
              <td>çœŸå€¤ã‚’å¤–ã‹ã‚‰ä¿è¨¼</td>
              <td><span class="status-ng">Ã—</span></td>
              <td><span class="status-ok">â—</span></td>
            </tr>
            <tr>
              <td>è¨¼æ˜ãŒ Î£â‚ï¼ˆæ•´æ•°ï¼‰</td>
              <td><span class="status-ng">Ã—</span></td>
              <td><span class="status-ok">â—</span></td>
            </tr>
          </tbody>
        </table>
      </div>

      <div class="ledger-wrap">
        <table class="ledger-table">
          <thead>
            <tr>
              <th>step</th>
              <th class="num-col">å¯„ä¸(int)</th>
              <th class="num-col">ç´¯ç©å’Œ</th>
              <th class="num-col">å®‰å…¨ä¸Šç•Œ</th>
              <th class="num-col">ä½™è£• Î´</th>
              <th>åˆ¤å®š</th>
            </tr>
          </thead>
          <tbody id="ledger-tbody">
            <!-- JSã§å‹•çš„ã«ç”Ÿæˆ -->
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <div class="footer-msg">
    ç„¡é™ã‚’å‰æã«ã—ãªãã¦ã‚‚ã€ä¸–ç•Œã¯è¨˜è¿°ã§ãã‚‹ã€‚<br>
    ã©ã“ã¾ã§å±Šãå ´ã«ã™ã‚‹ã‹ã‚’æ±ºã‚ã€ãã®ç¯„å›²ã ã‘ã¯èª¤é­”åŒ–ã•ãšã«è²¬ä»»ã‚’å–ã‚‹ã€‚<br>
    å ´ã®æœ‰é™æ€§ã¨ç§‘å­¦ã®è‰¯å¿ƒã¨ã„ã†æ¹¯å·ã®ãƒ©ã‚¤ãƒ³ã‚’ã€è¨ˆç®—ã¨è¨¼æ˜ã®å´ã«å¼•ãç¶™ã„ã ã‚‚ã®ãŒ GhostDrift ã§ã™ã€‚
  </div>

</div>

<!-- ä¸Šç´šè€…å‘ã‘ãƒ¢ãƒ¼ãƒ€ãƒ« -->
<div class="modal-overlay" id="expert-modal">
  <div class="modal-content">
    <button class="modal-close" id="expert-close-btn">&times;</button>
    <div class="modal-header">è§£æçš„æ•°è«–ã‹ã‚‰è¦‹ãŸ YukawaÃ—GhostDrift æœ‰é™é–‰åŒ…ã®ç‰¹ç•°æ€§</div>
    <div class="modal-body">
      <p>
        è§£æå±‹ã®ç›®ç·šã§è¨€ã†ã¨ã€ã“ã®ãƒ‡ãƒ¢ã§ã‚„ã£ã¦ã„ã‚‹ã“ã¨ã¯ã€Œãµã¤ã†ã®æ˜ç¤ºå…¬å¼ï¼‹ãƒ†ã‚¹ãƒˆé–¢æ•°è¨­è¨ˆã€ã®å»¶é•·ã§ã¯ã¾ãšè¾¿ã‚Šç€ã‘ãªã„ã€ä¸‰ã¤çµ„ã®å•é¡Œã‚’åŒæ™‚ã«è§£ã„ã¦ã„ã¾ã™ã€‚<br>
        ç‰©ç†å´ã§ã„ãˆã°ã€æ¹¯å·ãŒã€Œç„¡é™ã«å±ŠãåŠ›å­¦ã€ã‹ã‚‰ã€Œæœ‰é™ã«å±Šãå ´ã€ã¸ã¨ä¸–ç•Œåƒã‚’åˆ‡ã‚Šæ›¿ãˆãŸã®ã¨åŒã˜ã“ã¨ã‚’ã€ãƒªãƒ¼ãƒãƒ³ä¸–ç•Œã¨èª¤å·®è©•ä¾¡ã€ãã—ã¦ OS ã®è¨­è¨ˆã«å¯¾ã—ã¦ã¾ã¨ã‚ã¦ã‚„ã£ã¦ã„ã‚‹ã‚¤ãƒ¡ãƒ¼ã‚¸ã§ã™ã€‚
      </p>

      <div class="modal-section">
        <div class="modal-section-title"><span class="modal-tag">å•é¡Œâ‘ </span> ã‚«ãƒ¼ãƒãƒ«è¨­è¨ˆã®é™ç•Œ</div>
        <p>å¤å…¸çš„ãªæ˜ç¤ºå…¬å¼ã§ã¯ã€ãƒ†ã‚¹ãƒˆé–¢æ•° $\phi$ / ã‚«ãƒ¼ãƒãƒ« $K$ ã®è¨­è¨ˆã§æ¬¡ã‚’åŒæ™‚ã«æº€ãŸãã†ã¨ã—ã¾ã™ï¼š</p>
        <ol>
          <li>å®Ÿç©ºé–“ã§å±€æ‰€åŒ–ã—ã¦ã„ã‚‹ï¼ˆé ãã¯åŠ¹ã‹ãªã„ï¼‰</li>
          <li>ãƒ•ãƒ¼ãƒªã‚¨å´ã§æ‰±ã„ã‚„ã™ã„</li>
          <li>ä¸€æ–¹å‘ã®ä¸ç­‰å¼ï¼ˆâ€œå¤–å´ã‹ã‚‰ã®â€çœŸå€¤ä¿è¨¼ï¼‰ã«ä½¿ãˆã‚‹æ­£æ€§æ§‹é€ ãŒã‚ã‚‹</li>
        </ol>
        <div class="modal-math-block">
          ã“ã®æ‰‹æ³•ã§ã¯ã€Yukawa å´ã§ã€Œç‰©ç†çš„ãªæœ‰é™ä½œç”¨ï¼ˆä¸€å®šè·é›¢ã§ã»ã¼ã‚¼ãƒ­ï¼‰ã€ã‚’ç¢ºä¿ã—ã¤ã¤ã€FejÃ©r å´ã§ã€Œãƒ•ãƒ¼ãƒªã‚¨å´ã®æ­£æ€§ã¨å¹³å‡åŒ–ã«ã‚ˆã‚‹å¤–å´ã‹ã‚‰ã®çœŸå€¤ä¿è¨¼ã€ã‚’ç¢ºä¿ã—ã€ãã®çµ„ã¿åˆã‚ã›ã‚’ $\delta_{\mathrm{pos}}$ ã®ä¸€æ–¹å‘ä¸‹ç•Œã«è½ã¡ã‚‹å½¢ã«â€œèª¿æ•´â€ã—ãŸ <strong>YukawaÃ—FejÃ©r ã‚«ãƒ¼ãƒãƒ«</strong>ã¨ã—ã¦è¨­è¨ˆã—ã¦ã„ã¾ã™ã€‚
        </div>
      </div>

      <div class="modal-section">
        <div class="modal-section-title"><span class="modal-tag">å•é¡Œâ‘¡</span> ãƒªãƒ¼ãƒãƒ³ä¸–ç•Œã®ã€Œæœ‰é™é–‰åŒ…ã€</div>
        <p>é€šå¸¸ã®æ˜ç¤ºå…¬å¼ã¯ã€ç„¡é™ã‚¹ãƒˆãƒªãƒƒãƒ—ã‚„ç„¡é™é ã®å¢ƒç•Œæ¡ä»¶ã‚’å‰æã«ã—ãŸã€Œéã‚³ãƒ³ãƒ‘ã‚¯ãƒˆãªè§£æä¸–ç•Œã€ã®ä¸Šã§æ›¸ã‹ã‚Œã¦ã„ã¾ã™ã€‚ã“ã“ã‹ã‚‰ã€Œæœ‰é™å€‹ã®æ•´æ•°ä¸ç­‰å¼ã«å…¨éƒ¨è½ã¨ã™ã€ã“ã¨è‡ªä½“ãŒã€æ§‹é€ çš„ã«ã»ã¼ä¸å¯èƒ½ã§ã—ãŸã€‚</p>
        <p>ã“ã“ã§ã‚„ã£ã¦ã„ã‚‹ã®ã¯ã€<strong>ãƒªãƒ¼ãƒãƒ³ä¸–ç•Œã‚’ä¸€åº¦ ãƒã‚¢ãƒ³ã‚«ãƒ¬çš„ã«ã€Œæœ‰é™ãªå®‡å®™ã€ã¨ã—ã¦é–‰ã˜ã¦ã—ã¾ã†</strong>ã“ã¨ã€‚ãã®æœ‰é™å®‡å®™ã®ä¸­ã§ YukawaÃ—FejÃ©r ã‚«ãƒ¼ãƒãƒ«ã‚’ é›¢æ•£ãƒ©ãƒ—ãƒ©ã‚·ã‚¢ãƒ³ã®ã‚°ãƒªãƒ¼ãƒ³é–¢æ•°ï¼‹æœ‰é™çª“å¹³å‡ã¨ã—ã¦å†è§£é‡ˆã—ã€ç„¡é™é å¢ƒç•Œã‹ã‚‰ã®å¯„ä¸ã‚’ã€Œãã‚‚ãã‚‚è€ƒãˆãªã„ã‚²ãƒ¼ãƒ ã€ã«ãƒ«ãƒ¼ãƒ«å¤‰æ›´ã—ã¦ã„ã¾ã™ã€‚</p>
      </div>

      <div class="modal-section">
        <div class="modal-section-title"><span class="modal-tag">å•é¡Œâ‘¢</span> å…¨éƒ¨ã‚’ Î£â‚ å°å¸³ã«è½ã¨ã™</div>
        <div class="modal-math-block">
          $$ \delta_{\mathrm{pos}} \ge m_{\hat{K}}(\Delta)\cdot(\text{main} - \text{error}) > 0 $$
        </div>
        <p>ã“ã®æ‰‹æ³•ã§ã¯ã€å„é …ï¼ˆä¸»é …ãƒ»é›¶ç‚¹å’Œãƒ»ç´ æ•°å’Œãƒ»çª“èª¤å·®ï¼‰ã”ã¨ã«ãã‚Œãã‚Œæœ‰ç†æ•°ã®ä¸Šä¸‹ç•Œã‚’ä¸ãˆã€æœ€çµ‚çš„ã« 1 æœ¬ã® Î£â‚ ä¸ç­‰å¼ï¼ˆæ•´æ•°è¨ˆç®—ã ã‘ã§æ¤œè¨¼å¯èƒ½ï¼‰ã¨ã—ã¦è¨˜éŒ²ã—ã¦ã„ã¾ã™ã€‚</p>
      </div>

      <p>
        ã¤ã¾ã‚Šã€<strong>ã€Œç„¡é™è§£æã®ä¸–ç•Œã‚’å‡ºã¦ã€æ¹¯å·å‹ã®æœ‰é™ãªå ´ã®ç›´è¦³ã¨ã€ã©ã“ã¾ã§è²¬ä»»ã‚’è² ã†ã‹ã€ã¨ã„ã†è‰¯å¿ƒã‚’ãã®ã¾ã¾èƒŒè² ã£ãŸâ€œæœ‰é™é–‰åŒ… OSâ€ ã¨ã—ã¦ GhostDrift ãŒçœŸå€¤ã‚«ãƒ¼ãƒãƒ«ã‚’è¿”ã—ã¦ã„ã‚‹ã€</strong>ã¨èƒ¸ã‚’å¼µã£ã¦è¨€ãˆã‚‹æ§‹é€ ã«ãªã£ã¦ã„ã‚‹ã®ã§ã™ã€‚
      </p>
    </div>
  </div>
</div>

<!-- æ¹¯å·æ€æƒ³ãƒ¢ãƒ¼ãƒ€ãƒ« -->
<div class="modal-overlay" id="yukawa-modal">
  <div class="modal-content">
    <button class="modal-close" id="yukawa-close-btn">&times;</button>
    <div class="modal-header">æœ‰é™æ€§ã¨æ¹¯å·ç§€æ¨¹ã®æ€æƒ³</div>
    <div class="modal-body">
      
      <div class="modal-section">
        <div class="modal-section-title">æ±æ´‹çš„æ€ç´¢ã¨ç§‘å­¦â€•â€•æ¹¯å·ç§€æ¨¹ã®ä¸–ç•Œè¦³ã®åŸºç›¤</div>
        <p>æ¹¯å·ç§€æ¨¹ã¯å¹¼å°‘ã‚ˆã‚Šæ±æ´‹æ€æƒ³ã«è¦ªã—ã¿ã€å­”å­ã‚ˆã‚Šã‚‚è€å­ãƒ»è˜å­ã‚’å¥½ã‚“ã ã¨ã„ã„ã¾ã™ã€‚12æ­³é ƒã«ã¯æ—¢ã«å„’æ•™ã®æ•™ãˆã‚ˆã‚Šè€è˜æ€æƒ³ã«å¼·ãæƒ¹ã‹ã‚Œã€ã€Œè€è˜æ€æƒ³ã‚„èŠ­è•‰ã®æ€æƒ³ã‚’ç†è«–ç‰©ç†å­¦ã«å–ã‚Šã“ã‚“ã ã€ã®ã‚‚ã“ã®å‚¾å‘ã®å»¶é•·ã§ã—ãŸ[1]ã€‚å½¼ã¯æ¼¢è©©ã‚’æ„›ã—ã€æ±‚ã‚ã«å¿œã˜ã¦æ›¸ã‚’æ›¸ãéš›ã«ã¯è˜å­ã€Œç§‹æ°´ç¯‡ã€ã®æœ‰åãªä¸€ç¯€ã€ŒçŸ¥é­šæ¥½ã€ï¼ˆé­šã®æ¥½ã—ã¿ã‚’çŸ¥ã‚‹ï¼‰ã‚’æ›¸ã™ã‚‹ã“ã¨ãŒå¤šã‹ã£ãŸã¨ä¼ãˆã‚‰ã‚Œã¾ã™[2]ã€‚ã“ã®è˜å­ã®æ•…äº‹ã¯ã€äººé–“ã¨è‡ªç„¶ã¨ã®ç›´è¦³çš„ãªå…±æ„Ÿã‚’ç¤ºã™å¯“è©±ã§ã‚ã‚Šã€æ¹¯å·ã®æ ¹åº•ã«ã¯ç§‘å­¦ã¨è©©æƒ…ã€ç†æ€§ã¨ç›´è¦³ã®èª¿å’Œã‚’æ±‚ã‚ã‚‹æ±æ´‹çš„æ„Ÿæ€§ãŒæµã‚Œã¦ã„ãŸã¨è¨€ãˆã‚‹ã§ã—ã‚‡ã†ã€‚</p>
      </div>

      <div class="modal-section">
        <div class="modal-section-title">ã€Œå ´ã€ã®æ€æƒ³ï¼šæ¹¯å·ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰æ¦‚å¿µã¨GhostDriftã®æœ‰é™é–‰åŒ…</div>
        <p>æ¹¯å·ç§€æ¨¹ã®ç‰©ç†å­¦ä¸Šã®é©æ–°ã¯ã€å¾“æ¥è¦‹éã”ã•ã‚ŒãŒã¡ã ã£ãŸã€Œå ´ï¼ˆå ´æ‰€ï¼‰ã€ã‚„ã€Œã‚‚ã®ã¨ã‚‚ã®ã®é–“ã€ã¸ã®ç€ç›®ã‹ã‚‰ç”Ÿã¾ã‚Œã¾ã—ãŸã€‚ã“ã®ç™ºæƒ³è»¢æ›ã«ã‚ˆã‚Šã€æ¹¯å·ã¯è·é›¢ã«ä¾å­˜ã—ã¦æ€¥æ¿€ã«æ¸›è¡°ã™ã‚‹æ ¸åŠ›ã®å­˜åœ¨ã‚’èª¬æ˜ã—ã¾ã—ãŸï¼ˆæ¹¯å·ãƒãƒ†ãƒ³ã‚·ãƒ£ãƒ«: $V(r)=e^{-\mu r}/r$ï¼‰ã€‚å®Ÿéš›ã€æ¹¯å·ãƒãƒ†ãƒ³ã‚·ãƒ£ãƒ«ã«ã‚ˆã‚‹åŠ›ã¯ååˆ†é›¢ã‚ŒãŸè·é›¢ã§ã¯äº‹å®Ÿä¸Šã‚¼ãƒ­ã«ã¾ã§æ¸›è¡°ã—ã€ç›¸äº’ä½œç”¨ã®å½±éŸ¿ç¯„å›²ã¯æœ‰é™ã«ãªã‚Šã¾ã™[6][7]ã€‚</p>
        <p>ã“ã†ã—ãŸæ¹¯å·ã®ã€Œå ´ã€ã¸ã®æ´å¯Ÿã¯ã€GhostDriftæœ‰é™é–‰åŒ…OSã®ã‚³ãƒ³ã‚»ãƒ—ãƒˆã¨å“²å­¦çš„ã«éŸ¿ãåˆã†ã‚‚ã®ãŒã‚ã‚Šã¾ã™ã€‚GhostDriftã§ã¯ã€è§£æçš„ãªç„¡é™ã®ä¸–ç•Œã‚’ä¸€åº¦ã€Œæœ‰é™ãªå®‡å®™ã€ã¨ã—ã¦é–‰ã˜ã¦ã—ã¾ã†ã¨ã„ã†ã‚¢ãƒ—ãƒ­ãƒ¼ãƒãŒæ ¸ã«ãªã£ã¦ã„ã¾ã™[13]ã€‚æ¹¯å·ã®ç‰©ç†ãƒ¢ãƒ‡ãƒ«ãŒã€Œé æ–¹ã§ã¯åŠ›ãŒæ¶ˆãˆã‚‹å ´ã€ã‚’å°å…¥ã—ãŸã‚ˆã†ã«ã€GhostDriftã‚‚ã€Œé æ–¹ï¼ˆç„¡é™é ˜åŸŸï¼‰ã®å¯„ä¸ã‚’ã‚¼ãƒ­ã¨è¦‹ãªã›ã‚‹å ´ã€ã‚’æ§‹ç¯‰ã—ã¦ã„ã‚‹ã®ã§ã™ã€‚</p>
      </div>

      <div class="modal-section">
        <div class="modal-section-title">é™å¯‚ãƒ»æœ‰é™ãƒ»å‰µé€ æ€§ãƒ»æ°¸é æ€§</div>
        <p>æ¹¯å·ç§€æ¨¹ã®æ€æƒ³ã«ã¯ã€ã€Œé™ã‘ã•ã€ã‚„ã€Œæœ‰é™æ€§ã€ã®ä¾¡å€¤ã€ãã—ã¦ã€Œå‰µé€ æ€§ã€ã¸ã®æ·±ã„æ´å¯ŸãŒè¦‹ã‚‰ã‚Œã¾ã™ã€‚æ¹¯å·ã¯é™å¯‚ã®ä¸­ã«èº«ã‚’ç½®ãæ€ç´¢ã™ã‚‹ã“ã¨ã§æ–°ãŸãªè¦–ç•Œã‚’å¾—ã¾ã—ãŸã€‚GhostDriftã¯ç„¡é™ã®å•é¡Œã‚’ä¸€åº¦ç«‹ã¡æ­¢ã¾ã£ã¦æœ‰é™ã«åŒºåˆ‡ã‚Šç›´ã™ã“ã¨ã§ã€æœ¬è³ªçš„ãªçœŸå€¤ã«é›†ä¸­ã—ã¾ã™ã€‚ç„¡é™ã®å¯èƒ½æ€§ã«éš›é™ãªãé£›ã³ã¤ãã®ã§ã¯ãªãã€ä¸€æ—¦é™ã‹ã«æœ‰é™ã®æ çµ„ã¿ã‚’å®šã‚ã‚‹[16]â€”â€”ãã®ã‚¢ãƒ—ãƒ­ãƒ¼ãƒã«ã¯ã€æ¹¯å·çš„ãªæ²ˆç€å†·é™ã•ãŒæ„Ÿã˜ã‚‰ã‚Œã¾ã™ã€‚</p>
      </div>

      <div class="modal-section">
        <div class="modal-section-title">æ–‡è„ˆã¨ã—ã¦ã®æ¹¯å·æ€æƒ³ã¨GhostDriftã®ä½ç½®ã¥ã‘</div>
        <p>GhostDriftã‚’æ¹¯å·ã®æ€æƒ³ã®æ–‡è„ˆã«ä½ç½®ã¥ã‘ã‚‹ãªã‚‰ã€ã“ã†è¨€ãˆã‚‹ã§ã—ã‚‡ã†ã€‚ã™ãªã‚ã¡GhostDriftæœ‰é™é–‰åŒ…OSã¨ã¯ã€æ¹¯å·ç§€æ¨¹ãŒè’”ã„ãŸæ€æƒ³ã®ç¨®å­ãŒã€è¨ˆç®—æ©Ÿç§‘å­¦ã¨ã„ã†æ–°ãŸãªåœŸå£Œã§èŠ½å¹ã„ãŸä¸€ã¤ã®èŠ±ã§ã‚ã‚‹ã¨ã€‚</p>
      </div>

      <div class="modal-ref-list">
        <strong>å‚è€ƒæ–‡çŒ®ãƒ»å‡ºå…¸ï¼š</strong>
        <ul>
          <li>[1] æ¹¯å·ç§€æ¨¹ã€æ—…äººâ€•ã‚ã‚‹ç‰©ç†å­¦è€…ã®å›æƒ³ã€(è‡ªä¼, 1961å¹´)</li>
          <li>[2] ãã®ä»–ã€æ¹¯å·ç§€æ¨¹è¨˜å¿µé¤¨è³‡æ–™ç­‰</li>
          <li>[3] æ¹¯å·ç§€æ¨¹ã€ç¾ä»£ç§‘å­¦ã¨äººé–“ã€(è¬›æ¼”, 1961å¹´) ç­‰</li>
          <li>[4] æ¹¯å·ç§€æ¨¹ã€è‡ªç„¶ã¨ç†æ€§ã€(éšç­†é›†, 1947å¹´) æ‰€åã€Œé™ã‹ã«æ€ã†ã€</li>
          <li>[6][7][13][14][15] GhostDriftæœ‰é™é–‰åŒ…OS ãƒ‡ãƒ¢è³‡æ–™</li>
        </ul>
      </div>

    </div>
  </div>
</div>

<script>
/**
 * å…±é€šï¼šãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ï¼ˆæ³¢ç´‹ï¼‰æç”»ã‚¯ãƒ©ã‚¹
 * ç™½åœ°ã‚­ãƒ£ãƒ³ãƒã‚¹ç”¨ã«è‰²èª¿æ•´
 */
function createField(id, opts) {
  const canvas = document.getElementById(id);
  const ctx = canvas.getContext('2d');
  
  let w, h, cx, cy, maxR;
  const rings = 12;
  const dots = 60;

  function resize() {
    const rect = canvas.getBoundingClientRect();
    const dpr = window.devicePixelRatio || 1;
    canvas.width = rect.width * dpr;
    canvas.height = rect.height * dpr;
    ctx.scale(dpr, dpr);
    w = rect.width;
    h = rect.height;
    cx = w / 2;
    cy = h / 2;
    maxR = Math.min(w, h) * 0.42; // ã‚¹ãƒãƒ›ç”¨ã«å°‘ã—ä½™ç™½ã‚’æŒãŸã›ã‚‹
  }
  resize();
  window.addEventListener('resize', resize);

  function draw(t) {
    // èƒŒæ™¯ï¼šç™½ã€œè–„ã„ã‚°ãƒ¬ãƒ¼ã®å††å½¢ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆæ¯å±±æ°´çš„ãªé™ã‘ã•ï¼‰
    const grad = ctx.createRadialGradient(cx, cy, 0, cx, cy, maxR*1.5);
    grad.addColorStop(0, '#ffffff');
    grad.addColorStop(1, '#f0f0f5');
    ctx.fillStyle = grad;
    ctx.fillRect(0, 0, w, h);

    // ã‚°ãƒªãƒƒãƒ‰ç·šï¼ˆæ˜Ÿå›³çš„è¡¨ç¾ï¼‰
    ctx.strokeStyle = 'rgba(0,0,0,0.03)';
    ctx.lineWidth = 1;
    ctx.beginPath();
    ctx.moveTo(0, cy); ctx.lineTo(w, cy);
    ctx.moveTo(cx, 0); ctx.lineTo(cx, h);
    ctx.stroke();

    const pulse = 1 + Math.sin(t * 2) * 0.05;
    ctx.beginPath();
    ctx.arc(cx, cy, maxR * 0.15 * pulse, 0, Math.PI*2);
    ctx.fillStyle = opts.coreColor;
    ctx.fill();

    // æœ‰é™ã®å¢ƒç•Œç·šï¼ˆã‚ã‚Œã°ï¼‰
    if (opts.cutoff) {
      const muFactor = opts.mu ? Math.max(0.3, 1.2 / opts.mu) : 1;
      const cutoffR = maxR * opts.cutoff * muFactor;

      ctx.beginPath();
      ctx.arc(cx, cy, cutoffR, 0, Math.PI*2);
      ctx.strokeStyle = 'rgba(30, 63, 102, 0.3)';
      ctx.setLineDash([4, 4]);
      ctx.stroke();
      ctx.setLineDash([]);
      
      ctx.beginPath();
      ctx.arc(cx, cy, maxR*2, 0, Math.PI*2);
      ctx.arc(cx, cy, cutoffR, 0, Math.PI*2, true);
      ctx.fillStyle = 'rgba(0,0,0,0.05)';
      ctx.fill();
    }

    for (let i = 1; i <= rings; i++) {
      const baseR = (i / rings) * maxR;
      const rNorm = i / rings; 
      let amp = opts.ampFunc(rNorm, opts.mu || 1); 
      
      for (let j = 0; j < dots; j++) {
        const angle = (j / dots) * Math.PI * 2 + t * 0.1;
        const wave = Math.sin(rNorm * 10 - t * 3);
        const r = baseR + wave * (maxR * 0.05) * amp;
        const x = cx + Math.cos(angle) * r;
        const y = cy + Math.sin(angle) * r;
        
        // ç²’å­ã®ã‚µã‚¤ã‚ºã¨è‰²ï¼ˆã‚¤ãƒ³ã‚¯ã®ã‚ˆã†ãªæ¿ƒã„è‰²ï¼‰
        const size = 1.5 * (amp + 0.5);
        const alpha = 0.4 + 0.6 * amp;

        ctx.beginPath();
        ctx.arc(x, y, Math.max(0, size), 0, Math.PI*2);
        ctx.fillStyle = `rgba(${opts.dotColor}, ${alpha})`;
        ctx.fill();
      }
    }
  }

  function setMu(mu) {
    opts.mu = mu;
  }

  return { draw, setMu };
}

/**
 * å…±é€šï¼šã‚°ãƒ©ãƒ•ï¼ˆæ£’ã‚°ãƒ©ãƒ•ï¼‰æç”»ã‚¯ãƒ©ã‚¹
 */
function createGraph(id, opts) {
  const canvas = document.getElementById(id);
  const ctx = canvas.getContext('2d');
  
  let w, h;
  const bars = 30; // ã‚¹ãƒãƒ›å‘ã‘ã«æœ¬æ•°ã‚’æ¸›ã‚‰ã—ã¦è¦‹ã‚„ã™ã

  function resize() {
    const rect = canvas.getBoundingClientRect();
    const dpr = window.devicePixelRatio || 1;
    canvas.width = rect.width * dpr;
    canvas.height = rect.height * dpr;
    ctx.scale(dpr, dpr);
    w = rect.width;
    h = rect.height;
  }
  resize();
  window.addEventListener('resize', resize);

  function draw(t) {
    ctx.fillStyle = '#ffffff';
    ctx.fillRect(0, 0, w, h);

    const groundY = h * 0.8;
    ctx.strokeStyle = 'rgba(0,0,0,0.2)';
    ctx.beginPath();
    ctx.moveTo(0, groundY);
    ctx.lineTo(w, groundY);
    ctx.stroke();

    const barW = w / bars;
    const shift = opts.scroll ? (t * 2) % 1 : 0;

    for (let i = 0; i < bars; i++) {
      let idx = i + shift;
      let val = 0;
      if (typeof window.kernelGraphFn === 'function' && id === 'cvs-series-fin') {
        val = window.kernelGraphFn(idx);
      } else {
        val = opts.valFunc(idx, bars);
      }

      const x = i * barW;
      const barH = val * (h * 0.6);
      const y = groundY - barH;

      const alpha = 0.5 + val * 0.5;
      ctx.fillStyle = `rgba(${opts.color}, ${alpha})`;
      ctx.fillRect(x + 1, y, barW - 2, barH);
    }

    if (window.currentN) {
      const N_MIN = 5;
      const N_MAX = 40;
      // ã‚¹ãƒãƒ›ç”¨ã«ã‚¹ã‚±ãƒ¼ãƒ«èª¿æ•´
      const ratio = Math.min(1, Math.max(0, (window.currentN - N_MIN) / (N_MAX - N_MIN)));
      const nX = ratio * w;
      ctx.beginPath();
      ctx.moveTo(nX, 0);
      ctx.lineTo(nX, h);
      ctx.strokeStyle = 'rgba(30, 63, 102, 0.5)';
      ctx.setLineDash([2, 2]);
      ctx.stroke();
      ctx.setLineDash([]);
    }
  }
  return { draw };
}

// --- ãƒ¡ã‚¤ãƒ³å‡¦ç† ---
window.onload = () => {
  const t0 = performance.now();

  const f1 = createField('cvs-field-inf', {
    coreColor: '#1e3f66',
    dotColor: '30, 63, 102',
    cutoff: null,
    ampFunc: (r, mu) => 1 / (1 + r * (3 + mu * 0.5))
  });

  const f2 = createField('cvs-field-fin', {
    coreColor: '#6a4c9c',
    dotColor: '106, 76, 156',
    cutoff: 0.6,
    ampFunc: (r, mu) => Math.exp(-r * (4 + mu * 6))
  });

  const g1 = createGraph('cvs-series-inf', {
    color: '30, 63, 102',
    scroll: true,
    valFunc: (i) => 1 / (1 + Math.log(i + 1))
  });

  let finiteCutoffN = 16;
  const g2 = createGraph('cvs-series-fin', {
    color: '106, 76, 156',
    scroll: false,
    cutoffIdx: 25,
    valFunc: (i) => Math.exp(-i * 0.05)
  });

  // Î¼ ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼é€£å‹•
  const muSlider = document.getElementById('mu-slider');
  const muValue = document.getElementById('mu-value');
  if (muSlider && muValue) {
    const updateMu = () => {
      const mu = parseFloat(muSlider.value);
      muValue.textContent = mu.toFixed(1);
      f1.setMu(mu);
      f2.setMu(mu);
    };
    muSlider.addEventListener('input', updateMu);
    updateMu();
  }

  // ã‚«ãƒƒãƒˆã‚ªãƒ• Nãƒ»ã‚«ãƒ¼ãƒãƒ«ãƒ»èª¤å·®ãƒ»å°å¸³ãƒ­ãƒƒã‚¯
  const EPS_SAFE = 0.02;
  let finiteSafeUnlocked = false;
  let kernelMode = "yukawaFejer";

  const ledgerPanel = document.getElementById("ledger-panel");
  const cutoffSlider = document.getElementById("cutoff-slider");
  const cutoffValue  = document.getElementById("cutoff-value");
  const errNaiveEl   = document.getElementById("err-naive");
  const errFiniteEl  = document.getElementById("err-finite");
  const ledgerTbody = document.getElementById('ledger-tbody');

  const kernelSelect = document.getElementById("kernel-select");
  const lampRange = document.getElementById("lamp-range");
  const lampTruth = document.getElementById("lamp-truth");
  const lampSigma = document.getElementById("lamp-sigma");

  const kernelProfiles = {
    naive: { finite: "ok", truth: "fail", sigma: "fail" },
    gauss: { finite: "partial", truth: "fail", sigma: "fail" },
    fejer: { finite: "partial", truth: "ok", sigma: "partial" },
    yukawa: { finite: "ok", truth: "partial", sigma: "partial" },
    yukawaFejer: { finite: "ok", truth: "ok", sigma: "ok" }
  };

  function applyLampState(el, state) {
    if (!el) return;
    el.classList.remove("cond-ok", "cond-partial", "cond-fail");
    if (state === "ok") el.classList.add("cond-ok");
    else if (state === "partial") el.classList.add("cond-partial");
    else el.classList.add("cond-fail");
  }

  function naiveError(N) {
    const x = N;
    return 0.16 + 0.06 * Math.sin(x * 0.7) + 0.03 * Math.cos(x * 0.3);
  }
  function gaussError(N) {
    const x = Math.max(0, N - 5);
    return 0.14 + 0.05 * Math.exp(-x / 15); 
  }
  function fejerError(N) {
    const x = Math.max(0, N - 8);
    return 0.06 + 0.04 * Math.abs(Math.sin(x * 0.4)); 
  }
  function yukawaOnlyError(N) {
    const x = Math.max(0, N - 6);
    return 0.05 + 0.03 * Math.exp(-x / 10); 
  }
  function yukawaFejerError(N) {
    const x = Math.max(0, N - 6);
    return 0.4 * Math.exp(-x / 6); 
  }

  function kernelError(N) {
    switch (kernelMode) {
      case "naive":       return naiveError(N);
      case "gauss":       return gaussError(N);
      case "fejer":       return fejerError(N);
      case "yukawa":      return yukawaOnlyError(N);
      case "yukawaFejer": return yukawaFejerError(N);
      default:            return naiveError(N);
    }
  }

  window.kernelGraphFn = function(i) {
    switch (kernelMode) {
      case "naive": return 1 / (1 + Math.log(i + 1));
      case "gauss": return Math.exp(-Math.pow(i/15, 2));
      case "fejer": return Math.max(0, 1 - i/30);
      case "yukawa": return Math.exp(-i * 0.15);
      case "yukawaFejer": 
        if (i > 25) return Math.exp(-(i-25))*0.1;
        return Math.exp(-i * 0.05);
      default: return Math.exp(-i * 0.05);
    }
  };

  function buildLedgerOnce() {
    if (finiteSafeUnlocked || !ledgerTbody) return;
    finiteSafeUnlocked = true;
    
    if (ledgerPanel) {
      ledgerPanel.classList.remove('locked');
      ledgerPanel.classList.add('ledger-unlocked-anim');
    }
    
    ledgerTbody.innerHTML = '';
    let sum = 0;
    const maxStep = 8;
    for (let k = 1; k <= maxStep; k++) {
      const val = k * 2 + 1;
      sum += val;
      const limit = sum + (10 - k) * 5;
      const margin = limit - sum;
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${k}</td>
        <td class="num-col">${val}</td>
        <td class="num-col">${sum}</td>
        <td class="num-col">${limit}</td>
        <td class="num-col">+${margin}</td>
        <td><span class="check-ok">âœ”</span></td>
      `;
      ledgerTbody.appendChild(tr);
    }
  }

  function updateCutoff() {
    if (!cutoffSlider) return;

    const N = parseInt(cutoffSlider.value, 10);
    window.currentN = N; 

    if (cutoffValue) {
      cutoffValue.textContent = String(N);
    }

    const eNaive  = naiveError(N);
    const eFinite = kernelError(N);

    if (errNaiveEl) {
      errNaiveEl.textContent = eNaive.toFixed(3);
      errNaiveEl.classList.remove("error-safe", "error-unsafe");
      errNaiveEl.classList.add(eNaive <= EPS_SAFE ? "error-safe" : "error-unsafe");
    }
    if (errFiniteEl) {
      errFiniteEl.textContent = eFinite.toFixed(3);
      errFiniteEl.classList.remove("error-safe", "error-unsafe");
      errFiniteEl.classList.add(eFinite <= EPS_SAFE ? "error-safe" : "error-unsafe");
    }

    // ãƒ©ãƒ³ãƒ—åˆ¶å¾¡
    const profile = kernelProfiles[kernelMode] || kernelProfiles.naive;
    
    applyLampState(lampRange, profile.finite);

    if (profile.truth === 'ok' && eFinite <= EPS_SAFE) {
      applyLampState(lampTruth, 'ok');
      
      if (profile.sigma === 'ok') {
        applyLampState(lampSigma, 'ok');
        buildLedgerOnce();
      } else {
        applyLampState(lampSigma, 'partial');
      }
    } else {
      applyLampState(lampTruth, profile.truth === 'ok' ? 'fail' : profile.truth);
      applyLampState(lampSigma, 'fail');
    }

    if (!(profile.sigma === 'ok' && eFinite <= EPS_SAFE)) {
      if (finiteSafeUnlocked) {
        finiteSafeUnlocked = false;
        if (ledgerPanel) {
          ledgerPanel.classList.add("locked");
          ledgerTbody.innerHTML = '';
        }
      }
    }
  }

  if (kernelSelect) {
    kernelMode = kernelSelect.value || "yukawaFejer";
    kernelSelect.addEventListener("change", () => {
      kernelMode = kernelSelect.value || "naive";
      finiteSafeUnlocked = false;
      if (ledgerPanel) {
        ledgerPanel.classList.add("locked");
        if(ledgerTbody) ledgerTbody.innerHTML = '';
      }
      updateCutoff();
    });
  }

  if (cutoffSlider) {
    cutoffSlider.addEventListener("input", updateCutoff);
  }

  function loop() {
    const t = (performance.now() - t0) / 1000;
    f1.draw(t);
    f2.draw(t);
    g1.draw(t);
    g2.draw(t);
    requestAnimationFrame(loop);
  }
  loop();

  updateCutoff();

  // å°å¸³ãƒã‚¤ãƒ©ã‚¤ãƒˆ
  let rowIdx = 0;
  setInterval(() => {
    if (!ledgerTbody || !ledgerTbody.children.length) return;
    const rows = ledgerTbody.querySelectorAll('tr');
    rows.forEach(r => r.classList.remove('active-row'));
    if (rows[rowIdx]) rows[rowIdx].classList.add('active-row');
    rowIdx = (rowIdx + 1) % rows.length;
  }, 800);

  // ãƒ¢ãƒ¼ãƒ€ãƒ«åˆ¶å¾¡
  const setupModal = (btnId, modalId, closeId) => {
    const btn = document.getElementById(btnId);
    const modal = document.getElementById(modalId);
    const close = document.getElementById(closeId);
    if(btn && modal && close) {
      btn.addEventListener('click', () => modal.classList.add('open'));
      close.addEventListener('click', () => modal.classList.remove('open'));
      modal.addEventListener('click', (e) => {
        if(e.target === modal) modal.classList.remove('open');
      });
    }
  };

  setupModal('expert-open-btn', 'expert-modal', 'expert-close-btn');
  setupModal('yukawa-open-btn', 'yukawa-modal', 'yukawa-close-btn');
};
</script>

</body>
</html>